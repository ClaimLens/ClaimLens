{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "ffc02736-8a20-40b3-804f-727fb78078c1",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "âœ… Generated 15000 Indian insurance claims\n",
      "\n",
      "ðŸ“Š Distribution:\n",
      "   Health: 7484 (49.9%)\n",
      "   Motor: 5295 (35.3%)\n",
      "   Property: 2221 (14.8%)\n",
      "\n",
      "ðŸš¨ Fraud Distribution:\n",
      "   Fraud cases: 1617 (10.8%)\n",
      "   Legitimate: 13383 (89.2%)\n",
      "\n",
      "ðŸ’° Amount Statistics (INR):\n",
      "             count           mean            std       min          25%  \\\n",
      "claim_type                                                                \n",
      "Health      7484.0   82269.206088  138256.211276   5000.00   24769.3625   \n",
      "Motor       5295.0  189319.980916  231584.253031   5007.96   25015.1650   \n",
      "Property    2221.0  389718.591058  312397.313462  20000.00  170294.5400   \n",
      "\n",
      "                  50%          75%         max  \n",
      "claim_type                                      \n",
      "Health       46289.73   88184.1175  4619214.76  \n",
      "Motor        84485.97  261592.0000   999413.61  \n",
      "Property    304828.07  520132.7200  2591377.18  \n",
      "\n",
      "âœ… Saved to: indian_insurance_fraud_comprehensive.csv\n",
      "\n",
      "ðŸ“‹ Sample Data:\n",
      "    claim_id claim_type  claim_amount       city  policy_holder_age  \\\n",
      "0  CLM100000     Health      46869.47  Ahmedabad                 25   \n",
      "1  CLM100001     Health      22466.87  Bangalore                 19   \n",
      "2  CLM100002      Motor     718529.99      Delhi                 21   \n",
      "3  CLM100003   Property     312428.36     Jaipur                 29   \n",
      "4  CLM100004     Health      45265.40  Bangalore                 60   \n",
      "5  CLM100005      Motor     862570.45  Hyderabad                 44   \n",
      "6  CLM100006     Health      44749.89     Jaipur                 46   \n",
      "7  CLM100007     Health      47591.91     Mumbai                 41   \n",
      "8  CLM100008   Property     527651.79    Kolkata                 28   \n",
      "9  CLM100009     Health      44707.93    Lucknow                 55   \n",
      "\n",
      "  policy_holder_gender  policy_age_days  past_claims_6months  \\\n",
      "0                 Male               26                    0   \n",
      "1                 Male             1839                    0   \n",
      "2                 Male               14                    0   \n",
      "3                 Male              247                    0   \n",
      "4                 Male               57                    0   \n",
      "5               Female              955                    0   \n",
      "6                 Male              321                    0   \n",
      "7               Female              238                    0   \n",
      "8               Female              174                    0   \n",
      "9                 Male              485                    1   \n",
      "\n",
      "              provider_name       service_type  ...  is_weekend  \\\n",
      "0         Manipal Hospitals           ICU Care  ...           0   \n",
      "1                     AIIMS    Preventive Care  ...           0   \n",
      "2          Mahindra Service         Total Loss  ...           0   \n",
      "3  Property Repair Services              Theft  ...           1   \n",
      "4          Apollo Hospitals           ICU Care  ...           1   \n",
      "5            Toyota Service         Total Loss  ...           0   \n",
      "6                     AIIMS            Surgery  ...           1   \n",
      "7          Apollo Hospitals            Surgery  ...           0   \n",
      "8  Property Repair Services               Fire  ...           0   \n",
      "9          Apollo Hospitals  General Treatment  ...           0   \n",
      "\n",
      "   is_round_amount  claim_date  fraud_score_calculated is_fraud  \\\n",
      "0                0  2025-08-06                   31.53        1   \n",
      "1                0  2025-08-14                   17.65        0   \n",
      "2                0  2025-09-11                  100.00        1   \n",
      "3                0  2025-10-11                   37.70        0   \n",
      "4                0  2025-10-11                   20.61        0   \n",
      "5                0  2025-09-02                   52.75        1   \n",
      "6                0  2025-09-06                    0.00        0   \n",
      "7                0  2025-10-10                    6.02        0   \n",
      "8                0  2025-08-13                   33.86        0   \n",
      "9                0  2025-08-20                    0.85        0   \n",
      "\n",
      "   vehicle_age_years  amount_per_policy_day  high_amount_flag  \\\n",
      "0                  0            1735.906296                 0   \n",
      "1                  0              12.210255                 0   \n",
      "2                 11           47901.999333                 1   \n",
      "3                  0            1259.791774                 1   \n",
      "4                  0             780.437931                 0   \n",
      "5                  4             902.270345                 1   \n",
      "6                  0             138.974814                 0   \n",
      "7                  0             199.129331                 0   \n",
      "8                  0            3015.153086                 1   \n",
      "9                  0              91.991626                 0   \n",
      "\n",
      "   new_policy_flag  frequent_claimer_flag  \n",
      "0                1                      0  \n",
      "1                0                      0  \n",
      "2                1                      0  \n",
      "3                0                      0  \n",
      "4                0                      0  \n",
      "5                0                      0  \n",
      "6                0                      0  \n",
      "7                0                      0  \n",
      "8                0                      0  \n",
      "9                0                      0  \n",
      "\n",
      "[10 rows x 22 columns]\n",
      "\n",
      "ðŸ“ˆ Fraud Rate by Claim Type:\n",
      "            sum      mean\n",
      "claim_type               \n",
      "Health      523  0.069882\n",
      "Motor       776  0.146553\n",
      "Property    318  0.143179\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from datetime import datetime, timedelta\n",
    "import random\n",
    "\n",
    "np.random.seed(42)\n",
    "\n",
    "def generate_comprehensive_indian_fraud_dataset(n_samples=15000):\n",
    "    \"\"\"\n",
    "    Generate realistic Indian insurance fraud dataset\n",
    "    Covering Health, Motor, and Property insurance\n",
    "    \"\"\"\n",
    "    \n",
    "    data = []\n",
    "    \n",
    "    # Indian city distribution\n",
    "    cities = ['Mumbai', 'Delhi', 'Bangalore', 'Hyderabad', 'Chennai', \n",
    "              'Kolkata', 'Pune', 'Ahmedabad', 'Jaipur', 'Lucknow']\n",
    "    \n",
    "    # Indian hospital names\n",
    "    hospitals = ['Apollo Hospitals', 'Fortis Healthcare', 'Max Healthcare',\n",
    "                 'Manipal Hospitals', 'AIIMS', 'Lilavati Hospital',\n",
    "                 'Kokilaben Hospital', 'Medanta', 'Narayana Health']\n",
    "    \n",
    "    # Indian garages\n",
    "    garages = ['Maruti Service Center', 'Hyundai Workshop', 'Tata Motors',\n",
    "               'Mahindra Service', 'Honda Authorized', 'Toyota Service']\n",
    "    \n",
    "    for i in range(n_samples):\n",
    "        # Basic info\n",
    "        claim_id = f\"CLM{str(100000 + i).zfill(6)}\"\n",
    "        \n",
    "        # Claim type distribution (India-specific)\n",
    "        claim_type = np.random.choice(\n",
    "            ['Health', 'Motor', 'Property'],\n",
    "            p=[0.50, 0.35, 0.15]  # Health most common in India\n",
    "        )\n",
    "        \n",
    "        # Location\n",
    "        city = np.random.choice(cities)\n",
    "        \n",
    "        # Policy holder info\n",
    "        age = int(np.random.normal(42, 15))\n",
    "        age = max(18, min(75, age))\n",
    "        \n",
    "        gender = np.random.choice(['Male', 'Female'], p=[0.6, 0.4])\n",
    "        \n",
    "        # Policy age\n",
    "        policy_age_days = int(np.random.exponential(450))  # Average 1.2 years\n",
    "        policy_age_days = max(1, min(3650, policy_age_days))  # Max 10 years\n",
    "        \n",
    "        # Past claims (6 months)\n",
    "        if policy_age_days < 180:\n",
    "            past_claims = np.random.poisson(0.1)\n",
    "        else:\n",
    "            past_claims = np.random.poisson(0.4)\n",
    "        \n",
    "        # --- CLAIM TYPE SPECIFIC FEATURES ---\n",
    "        \n",
    "        vehicle_age_years = 0  # Default for non-motor claims\n",
    "        \n",
    "        if claim_type == 'Health':\n",
    "            # Health-specific\n",
    "            hospital_name = np.random.choice(hospitals)\n",
    "            \n",
    "            # Claim amount (Indian context - in INR)\n",
    "            if np.random.random() < 0.7:  # Normal cases\n",
    "                base_amount = np.random.lognormal(10.5, 0.8)  # ~â‚¹30-80K\n",
    "            else:  # Serious cases\n",
    "                base_amount = np.random.lognormal(11.5, 1.0)  # ~â‚¹1-3L\n",
    "            \n",
    "            claim_amount = max(5000, min(5000000, base_amount))\n",
    "            \n",
    "            # Treatment type\n",
    "            treatment = np.random.choice([\n",
    "                'General Treatment', 'Surgery', 'ICU Care', \n",
    "                'Emergency', 'Preventive Care'\n",
    "            ])\n",
    "            \n",
    "            # Hospital tier\n",
    "            hospital_tier = np.random.choice(['Tier1', 'Tier2', 'Tier3'], \n",
    "                                           p=[0.3, 0.5, 0.2])\n",
    "            \n",
    "            provider_name = hospital_name\n",
    "            service_type = treatment\n",
    "            \n",
    "        elif claim_type == 'Motor':\n",
    "            # Motor-specific\n",
    "            garage_name = np.random.choice(garages)\n",
    "            \n",
    "            # Vehicle age\n",
    "            vehicle_age_years = int(np.random.exponential(4))\n",
    "            vehicle_age_years = max(0, min(15, vehicle_age_years))\n",
    "            \n",
    "            # Claim amount based on damage type\n",
    "            damage_type = np.random.choice([\n",
    "                'Minor Dent', 'Major Accident', 'Theft', \n",
    "                'Total Loss', 'Glass Damage'\n",
    "            ], p=[0.4, 0.3, 0.1, 0.1, 0.1])\n",
    "            \n",
    "            if damage_type == 'Minor Dent':\n",
    "                claim_amount = np.random.uniform(10000, 50000)\n",
    "            elif damage_type == 'Major Accident':\n",
    "                claim_amount = np.random.uniform(80000, 300000)\n",
    "            elif damage_type == 'Theft':\n",
    "                claim_amount = np.random.uniform(200000, 800000)\n",
    "            elif damage_type == 'Total Loss':\n",
    "                claim_amount = np.random.uniform(300000, 1000000)\n",
    "            else:  # Glass\n",
    "                claim_amount = np.random.uniform(5000, 25000)\n",
    "            \n",
    "            provider_name = garage_name\n",
    "            service_type = damage_type\n",
    "            \n",
    "        else:  # Property\n",
    "            # Property-specific\n",
    "            damage_type = np.random.choice([\n",
    "                'Fire', 'Theft', 'Water Damage', \n",
    "                'Natural Disaster', 'Vandalism'\n",
    "            ], p=[0.2, 0.3, 0.25, 0.15, 0.1])\n",
    "            \n",
    "            # Property value (Indian context)\n",
    "            property_value = np.random.lognormal(14, 0.5)  # ~â‚¹10-30L\n",
    "            \n",
    "            # Claim amount (% of property value)\n",
    "            damage_percent = np.random.beta(2, 5)  # Skewed to lower damage\n",
    "            claim_amount = property_value * damage_percent\n",
    "            claim_amount = max(20000, min(5000000, claim_amount))\n",
    "            \n",
    "            provider_name = 'Property Repair Services'\n",
    "            service_type = damage_type\n",
    "        \n",
    "        # Common features\n",
    "        \n",
    "        # Document quality score (0-100)\n",
    "        doc_quality = np.random.beta(7, 2) * 100\n",
    "        doc_quality = max(0, min(100, doc_quality))\n",
    "        \n",
    "        # Claim timing - FIXED: Probabilities now sum to exactly 1.0\n",
    "        hour_probabilities = np.array([\n",
    "            0.01, 0.01, 0.01, 0.01, 0.01, 0.02,  # 0-5 AM (rare)\n",
    "            0.03, 0.05, 0.06, 0.08, 0.09, 0.10,  # 6-11 AM (increasing)\n",
    "            0.09, 0.08, 0.07, 0.06, 0.05, 0.05,  # 12-5 PM (office hours)\n",
    "            0.04, 0.03, 0.03, 0.02, 0.02, 0.01   # 6-11 PM (decreasing)\n",
    "        ])\n",
    "        # Normalize to ensure sum = 1.0\n",
    "        hour_probabilities = hour_probabilities / hour_probabilities.sum()\n",
    "        \n",
    "        claim_hour = int(np.random.choice(range(24), p=hour_probabilities))\n",
    "        \n",
    "        claim_date = datetime.now() - timedelta(days=np.random.randint(1, 90))\n",
    "        is_weekend = 1 if claim_date.weekday() >= 5 else 0\n",
    "        \n",
    "        # Round amount flag\n",
    "        is_round_amount = 1 if (claim_amount % 50000 == 0 or \n",
    "                               claim_amount % 100000 == 0 or\n",
    "                               claim_amount % 25000 == 0) else 0\n",
    "        \n",
    "        # --- FRAUD SCORING LOGIC ---\n",
    "        fraud_score = 0\n",
    "        \n",
    "        # Factor 1: Amount-based risk\n",
    "        if claim_type == 'Health':\n",
    "            if claim_amount > 500000:\n",
    "                fraud_score += 35\n",
    "            elif claim_amount > 200000:\n",
    "                fraud_score += 20\n",
    "        elif claim_type == 'Motor':\n",
    "            if claim_amount > 400000:\n",
    "                fraud_score += 30\n",
    "            elif claim_amount > 150000:\n",
    "                fraud_score += 15\n",
    "        else:  # Property\n",
    "            if claim_amount > 1000000:\n",
    "                fraud_score += 35\n",
    "            elif claim_amount > 300000:\n",
    "                fraud_score += 20\n",
    "        \n",
    "        # Factor 2: Policy age\n",
    "        if policy_age_days < 15:\n",
    "            fraud_score += 35\n",
    "        elif policy_age_days < 30:\n",
    "            fraud_score += 25\n",
    "        elif policy_age_days < 90:\n",
    "            fraud_score += 10\n",
    "        \n",
    "        # Factor 3: Past claims\n",
    "        if past_claims >= 4:\n",
    "            fraud_score += 35\n",
    "        elif past_claims >= 3:\n",
    "            fraud_score += 25\n",
    "        elif past_claims >= 2:\n",
    "            fraud_score += 15\n",
    "        \n",
    "        # Factor 4: Document quality\n",
    "        if doc_quality < 40:\n",
    "            fraud_score += 25\n",
    "        elif doc_quality < 60:\n",
    "            fraud_score += 15\n",
    "        elif doc_quality < 75:\n",
    "            fraud_score += 5\n",
    "        \n",
    "        # Factor 5: Suspicious timing\n",
    "        if claim_hour >= 23 or claim_hour <= 4:\n",
    "            fraud_score += 15\n",
    "        \n",
    "        if is_weekend:\n",
    "            fraud_score += 8\n",
    "        \n",
    "        # Factor 6: Round amounts\n",
    "        if is_round_amount:\n",
    "            fraud_score += 12\n",
    "        \n",
    "        # Factor 7: Age-related risk\n",
    "        if age < 25 and claim_amount > 300000:\n",
    "            fraud_score += 15\n",
    "        \n",
    "        if age > 65 and claim_amount > 500000:\n",
    "            fraud_score += 10\n",
    "        \n",
    "        # Factor 8: Claim type specific\n",
    "        if claim_type == 'Motor':\n",
    "            if vehicle_age_years > 10:\n",
    "                fraud_score += 10\n",
    "            if service_type in ['Theft', 'Total Loss']:\n",
    "                fraud_score += 15\n",
    "        \n",
    "        if claim_type == 'Property':\n",
    "            if service_type == 'Fire':\n",
    "                fraud_score += 10  # Arson risk\n",
    "        \n",
    "        # Add randomness\n",
    "        fraud_score += np.random.normal(0, 8)\n",
    "        fraud_score = max(0, min(100, fraud_score))\n",
    "        \n",
    "        # Determine actual fraud\n",
    "        fraud_probability = fraud_score / 100\n",
    "        fraud_probability = fraud_probability ** 1.5  # Non-linear scaling\n",
    "        \n",
    "        is_fraud = 1 if np.random.random() < fraud_probability else 0\n",
    "        \n",
    "        # Build record\n",
    "        record = {\n",
    "            'claim_id': claim_id,\n",
    "            'claim_type': claim_type,\n",
    "            'claim_amount': round(claim_amount, 2),\n",
    "            'city': city,\n",
    "            'policy_holder_age': age,\n",
    "            'policy_holder_gender': gender,\n",
    "            'policy_age_days': policy_age_days,\n",
    "            'past_claims_6months': past_claims,\n",
    "            'provider_name': provider_name,\n",
    "            'service_type': service_type,\n",
    "            'document_quality_score': round(doc_quality, 2),\n",
    "            'claim_hour': claim_hour,\n",
    "            'is_weekend': is_weekend,\n",
    "            'is_round_amount': is_round_amount,\n",
    "            'claim_date': claim_date.strftime('%Y-%m-%d'),\n",
    "            'fraud_score_calculated': round(fraud_score, 2),\n",
    "            'is_fraud': is_fraud,\n",
    "            'vehicle_age_years': vehicle_age_years  # Include for all records\n",
    "        }\n",
    "        \n",
    "        data.append(record)\n",
    "    \n",
    "    df = pd.DataFrame(data)\n",
    "    \n",
    "    # Add derived features\n",
    "    df['amount_per_policy_day'] = df['claim_amount'] / (df['policy_age_days'] + 1)\n",
    "    df['high_amount_flag'] = (df['claim_amount'] > 200000).astype(int)\n",
    "    df['new_policy_flag'] = (df['policy_age_days'] < 30).astype(int)\n",
    "    df['frequent_claimer_flag'] = (df['past_claims_6months'] >= 2).astype(int)\n",
    "    \n",
    "    print(f\"\\nâœ… Generated {len(df)} Indian insurance claims\")\n",
    "    print(f\"\\nðŸ“Š Distribution:\")\n",
    "    print(f\"   Health: {len(df[df['claim_type']=='Health'])} ({len(df[df['claim_type']=='Health'])/len(df)*100:.1f}%)\")\n",
    "    print(f\"   Motor: {len(df[df['claim_type']=='Motor'])} ({len(df[df['claim_type']=='Motor'])/len(df)*100:.1f}%)\")\n",
    "    print(f\"   Property: {len(df[df['claim_type']=='Property'])} ({len(df[df['claim_type']=='Property'])/len(df)*100:.1f}%)\")\n",
    "    \n",
    "    print(f\"\\nðŸš¨ Fraud Distribution:\")\n",
    "    print(f\"   Fraud cases: {df['is_fraud'].sum()} ({df['is_fraud'].mean()*100:.1f}%)\")\n",
    "    print(f\"   Legitimate: {(1-df['is_fraud']).sum()} ({(1-df['is_fraud']).mean()*100:.1f}%)\")\n",
    "    \n",
    "    print(f\"\\nðŸ’° Amount Statistics (INR):\")\n",
    "    print(df.groupby('claim_type')['claim_amount'].describe())\n",
    "    \n",
    "    return df\n",
    "\n",
    "if __name__ == '__main__':\n",
    "    # Generate comprehensive dataset\n",
    "    df = generate_comprehensive_indian_fraud_dataset(15000)\n",
    "    \n",
    "    # Save\n",
    "    df.to_csv('indian_insurance_fraud_comprehensive.csv', index=False)\n",
    "    print(f\"\\nâœ… Saved to: indian_insurance_fraud_comprehensive.csv\")\n",
    "    \n",
    "    # Show samples\n",
    "    print(f\"\\nðŸ“‹ Sample Data:\")\n",
    "    print(df.head(10))\n",
    "    \n",
    "    # Fraud analysis by type\n",
    "    print(f\"\\nðŸ“ˆ Fraud Rate by Claim Type:\")\n",
    "    print(df.groupby('claim_type')['is_fraud'].agg(['sum', 'mean']))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "728b97e3-f118-402e-8f21-6d7822d0009b",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.19"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
